<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head('Pedidos')"></head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <div th:replace="fragments/header :: header"></div>
        <div th:replace="fragments/sidebar :: sidebar"></div>

        <div class="content-wrapper">
            <div class="content-header">
                <div class="container-fluid">
                    <h1 class="m-0"><i class="fas fa-shopping-basket"></i> Pedidos</h1>
                </div>
            </div>

            <section class="content">
                <div class="container-fluid">
                    <div class="card">
                        <div class="card-body">

                            <div class="mb-3">
                                <input id="pedidoSearch" class="form-control"
                                    placeholder="Buscar por cliente o nÃºmero de pedido">
                            </div>

                            <table class="table table-bordered table-striped datatable">
                                <thead>
                                    <tr>
                                        <th># Pedido</th>
                                        <th>Cliente</th>
                                        <th>Estado</th>
                                        <th>Total</th>
                                        <th>Fecha</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="p : ${pedidos}">
                                        <td th:text="${p.numeroPedido}">PED-001</td>
                                        <td th:text="${p.cliente.nombreCompleto}">Cliente</td>
                                        <td>
                                            <span
                                                th:classappend="${p.estado.name() == 'PENDIENTE'} ? 'badge badge-warning' : (p.estado.name() == 'ENVIADO') ? 'badge badge-info' : (p.estado.name() == 'ENTREGADO') ? 'badge badge-success' : 'badge badge-secondary'"
                                                th:text="${p.estado.nombre}">Estado</span>
                                        </td>
                                        <td th:text="'S/ ' + #numbers.formatDecimal(p.total,1,2)">S/0.00</td>
                                        <td th:text="${#temporals.format(p.fechaPedido,'dd/MM/yyyy HH:mm')}">01/01/2025
                                        </td>
                                        <td>
                                            <a th:href="@{/admin/pedidos/ver/{id}(id=${p.id})}"
                                                class="btn btn-sm btn-info"><i class="fas fa-eye"></i></a>
                                            <a th:href="@{/admin/pedidos/aceptar/{id}(id=${p.id})}"
                                                class="btn btn-sm btn-success"
                                                th:if="${p.estado.name() == 'PENDIENTE'}"><i
                                                    class="fas fa-check"></i></a>
                                            <a th:href="@{/admin/pedidos/enviar/{id}(id=${p.id})}"
                                                class="btn btn-sm btn-primary"
                                                th:if="${p.estado.name() == 'ACEPTADO'}"><i
                                                    class="fas fa-truck"></i></a>
                                            <a th:href="@{/admin/pedidos/cancelar/{id}(id=${p.id})}"
                                                class="btn btn-sm btn-danger btn-delete"
                                                th:data-name="${p.numeroPedido}"
                                                th:if="${p.estado.name() != 'ENTREGADO'}"><i
                                                    class="fas fa-times"></i></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div th:replace="fragments/footer :: footer"></div>
    </div>
    <div th:replace="fragments/scripts :: scripts"></div>
    <script>
        $(document).ready(function () {
            $('#pedidoSearch').on('keyup', function () {
                $('.datatable').DataTable().search($(this).val()).draw();
            });
        });
    </script>
</body>

</html>