<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head('Ventas')"></head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <div th:replace="fragments/header :: header"></div>
        <div th:replace="fragments/sidebar :: sidebar"></div>

        <div class="content-wrapper">
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1 class="m-0"><i class="fas fa-receipt"></i> Ventas</h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Inicio</a></li>
                                <li class="breadcrumb-item active">Ventas</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <section class="content">
                <div class="container-fluid">

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-list"></i> Lista de Ventas</h3>
                            <div class="card-tools">
                                <a th:href="@{/admin/ventas/pos}" class="btn btn-success"><i
                                        class="fas fa-cash-register"></i> Abrir POS</a>
                                <a th:href="@{/admin/ventas/nuevo}" class="btn btn-primary"><i class="fas fa-plus"></i>
                                    Nueva Venta</a>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="row mb-2">
                                <div class="col-md-3">
                                    <input type="text" id="filterCliente" class="form-control"
                                        placeholder="Buscar por cliente">
                                </div>
                                <div class="col-md-3">
                                    <select id="filterEstado" class="form-control">
                                        <option value="">Todos los estados</option>
                                        <option value="COMPLETADA">Completada</option>
                                        <option value="PENDIENTE">Pendiente</option>
                                        <option value="ANULADA">Anulada</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <input type="date" id="filterDesde" class="form-control">
                                </div>
                                <div class="col-md-3">
                                    <input type="date" id="filterHasta" class="form-control">
                                </div>
                            </div>

                            <table id="ventasTable" class="table table-bordered table-striped datatable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Cliente</th>
                                        <th>Total</th>
                                        <th>Pagos</th>
                                        <th>Estado</th>
                                        <th>Fecha</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="v : ${ventas}">
                                        <td th:text="${v.numeroVenta}">VEN-001</td>
                                        <td th:text="${v.cliente != null ? v.cliente.nombreCompleto : 'Cliente local'}">
                                            Cliente</td>
                                        <td th:text="'S/ ' + #numbers.formatDecimal(v.total,1,2)">S/0.00</td>
                                        <td th:text="${v.pagos != null ? v.pagos.size() : 0}">0</td>
                                        <td>
                                            <span
                                                th:classappend="${v.estado.name() == 'COMPLETADA'} ? 'badge badge-success' : (v.estado.name() == 'PENDIENTE') ? 'badge badge-warning' : 'badge badge-secondary'"
                                                th:text="${v.estado.nombre}">Estado</span>
                                        </td>
                                        <td th:text="${#temporals.format(v.fechaVenta,'dd/MM/yyyy HH:mm')}">01/01/2025
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group">
                                                <a th:href="@{/admin/ventas/ver/{id}(id=${v.id})}"
                                                    class="btn btn-sm btn-info" title="Ver"><i
                                                        class="fas fa-eye"></i></a>
                                                <a th:href="@{/admin/ventas/imprimir/{id}(id=${v.id})}"
                                                    class="btn btn-sm btn-secondary" title="Imprimir"><i
                                                        class="fas fa-print"></i></a>
                                                <a th:href="@{/admin/ventas/anular/{id}(id=${v.id})}"
                                                    class="btn btn-sm btn-danger btn-delete"
                                                    th:data-name="${v.numeroVenta}" title="Anular"><i
                                                        class="fas fa-ban"></i></a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>

                </div>
            </section>
        </div>

        <div th:replace="fragments/footer :: footer"></div>
    </div>

    <div th:replace="fragments/scripts :: scripts"></div>

    <script>
        $(document).ready(function () {
            // filtros b√°sicos client-side; puedes cambiarlos a server-side si el dataset es grande
            $('#filterCliente, #filterEstado, #filterDesde, #filterHasta').on('change keyup', function () {
                $('.datatable').DataTable().draw();
            });
        });
    </script>

</body>

</html>